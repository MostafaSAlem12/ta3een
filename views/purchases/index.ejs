<%- include('../partials/navbar',user)%>
<div class="w-75 text-center container mt-5">
        <h2 class="text-center mb-5">قائمة المشتروات</h2>
        <div class="w-50 py-3">
            <form action="/purchases" method="get">
                <div class="input-group">
                        <input type="hidden" value="<%=parseInt(page||1)%>" name="page">
                        <input type="search" class="form-control rounded" placeholder="بحث" aria-label="بحث"
                            aria-describedby="search-addon" name="q" value="<%=q%>"/>
                        <button type="submit" class="btn btn-primary mx-1 rounded"> <i class="bi bi-search"></i> </button>
                </div>
            </form>
        </div>        
   
        <%if (purchases.length > 0) {%>
            <table
                class="table table-responsive table-hover table-bordered mx-auto bg-white rounded shadow text-center">
                <thead class="table-primary">
                    <tr class="text-center">
                        <th>اسم الصنف</th>
                        <th>الكمية الحالية</th>
                        <th>تاريخ تسجيل الصنف</th>
                        <%if (user.role === 'admin'){%>
                            <th colspan="2">خيارات</th>
                        <%}%>
                    </tr>
                </thead>
                <tbody>
                    <% for (let purchase of purchases) {%>
                        <tr>
                            <td>
                                    <%= purchase.name %>
                            </td>
                            <td>
                                <%if (purchase.unit !== 'عدد') {%>
                                <%= purchase.amount >= 1000 && purchase.unit === 'جرام'?purchase.amount / 1000 : purchase.amount %> <%if (purchase.amount > 0) {%><%= purchase.amount >= 1000 && purchase.unit === 'جرام'?'كيلو' :purchase.unit %> <%}%>
                                <%} else {%>
                                    <%= purchase.amount %>
                                    <%}%>
                            </td>
                            <td>
                                <%= moment(new Date(purchase.createdAt)).format('DD-MM-YYYY') %>
                            </td>
                            <%if (user.role === 'admin'){%>
                            <td><a class="text-primary text-center btn btn-link text-decoration-none"
                                    href="/purchases/<%=purchase._id%>/editAmount">
                                    <i class="bi bi-pen-fill"></i>
                                        </a></td>
                            <td>
                                <form action="/purchases/<%=purchase._id%>/delete?_method=DELETE" method="post">
                                    <button type="submit" class="btn btn-link text-danger text-decoration-none">
                                            <i class="bi bi-trash-fill"></i>
                                    </button>
                                </form>
                            </td>
                            <%}%>
                        </tr>
                        <% } %>
                </tbody>
            </table>
                        <%if (pagesCount > 1) {%>
                <nav aria-label="Page navigation example" class="justify-content-center d-flex">
                    <ul class="pagination">
                        <%if (page> 1) {%> <li class="page-item"><a class="page-link"
                                    href="?page=<%=parseInt(page)-1%><%if (q) {%>&q=<%=q%> <%}%>">السابق</a></li>
                            <%}%>
                                <%for (let i=0; i < parseInt(pagesCount); i++) {%>
                                    <li class="<%if (parseInt(page) === i+1) {%> page-item active <%}else {%> page-item <%}%>>"><a class="page-link" href="<%if (parseInt(page) === i+1) {%>#<%}else {%>?page=<%=i+1%><%if (q) {%>&q=<%=q%> <%}%> <%}%>">
                                            <%=i+1%>
                                        </a></li>
                                    <%}%>


                                        <%if (page < parseInt(pagesCount)) {%>
                                            <li class="page-item"><a class="page-link"
                                                    href="?page=<%=parseInt(page)+1%><%if (q) {%>&q=<%=q%> <%}%>">التالي</a></li>
                                            <%}%>
                    </ul>
                </nav>
                <%}%>
            <%} else {%>
                
                        <div class="card text-center mb-3">
                            <h3 class="text-muted card-body">لا يوجد بيانات</h3>
                        </div>
                <%}%>
         
            </div>
        </html>